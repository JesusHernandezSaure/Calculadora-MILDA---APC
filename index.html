<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MILDAÂ® - Calculadora Profesional</title>
    <link rel="icon" type="image/png" href="D.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap');

        :root {
            --milda-blue: #004a99;
            --milda-dark: #001a35;
            --milda-gold: #d4af37;
            --milda-gold-bright: #ffcf40;
            --milda-silver: #e2e8f0;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #000b1a;
            background-image: 
                linear-gradient(rgba(212, 175, 55, 0.15) 1px, transparent 1px),
                linear-gradient(90deg, rgba(212, 175, 55, 0.15) 1px, transparent 1px);
            background-size: 40px 40px;
            color: var(--milda-silver);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .calculator-card {
            background: var(--milda-blue);
            width: 100%;
            max-width: 550px;
            border-radius: 20px;
            border: 2px solid var(--milda-gold);
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            overflow: hidden;
        }

        .header {
            background: #fff;
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid var(--milda-gold);
        }

        .logo { max-width: 200px; height: auto; }

        .content { padding: 30px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        .field { display: flex; flex-direction: column; margin-bottom: 15px; }
        label { font-size: 0.7rem; font-weight: 900; text-transform: uppercase; margin-bottom: 8px; color: var(--milda-silver); }

        input, select {
            background: var(--milda-dark);
            border: 1px solid var(--milda-gold);
            padding: 12px;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            outline: none;
        }

        .btn-main {
            width: 100%;
            padding: 20px;
            background: var(--milda-gold);
            color: #000;
            border: none;
            border-radius: 12px;
            font-weight: 900;
            text-transform: uppercase;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: 0.3s;
        }

        .btn-main:disabled { background: #334b66; color: #1a2a3a; cursor: not-allowed; opacity: 0.6; }

        .results {
            margin-top: 25px;
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            color: var(--milda-dark);
            display: none;
            text-align: center;
            border-top: 5px solid var(--milda-gold);
        }

        .res-ui { font-size: 3.5rem; font-weight: 900; color: var(--milda-blue); }
        .res-caps {
            background: var(--milda-dark);
            color: #fff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .note { font-size: 0.75rem; color: #d63031; font-weight: 700; margin-top: 10px; text-align: left; }
        .msg-adecuado { color: #004a99; font-weight: 800; font-size: 0.9rem; margin-top: 10px; }
        .hidden { display: none !important; }

        .comorb-box {
            grid-column: span 2;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="calculator-card">
    <div class="header">
        <img src="MILDA-LOGO.png" alt="MILDAÂ®" class="logo">
    </div>

    <div class="content">
        <div class="grid">
            <div class="field">
                <label>Edad (AÃ±os)</label>
                <input type="number" id="edad" step="0.1" placeholder="Ej: 30">
            </div>
            <div class="field">
                <label>Sexo</label>
                <select id="sexo">
                    <option value="">--</option>
                    <option value="M">Masculino</option>
                    <option value="F">Femenino</option>
                </select>
            </div>
            <div class="field">
                <label>Vitamina D Basal</label>
                <input type="number" id="basal" placeholder="ng/mL">
            </div>

            <div class="field adult-only hidden">
                <label>Peso (kg)</label>
                <input type="number" id="peso">
            </div>
            <div class="field adult-only hidden">
                <label>Talla (cm)</label>
                <input type="number" id="talla">
            </div>

            <div class="comorb-box adult-only hidden">
                <label>Comorbilidades / MedicaciÃ³n</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px;">
                    <div id="wrap-emb" class="hidden"><input type="checkbox" id="emb"> <span style="font-size: 0.8rem">Embarazo</span></div>
                    <div><input type="checkbox" id="pre"> <span style="font-size: 0.8rem">Prediabetes</span></div>
                    <div><input type="checkbox" id="ost"> <span style="font-size: 0.8rem">Osteoporosis</span></div>
                    <div><input type="checkbox" id="con"> <span style="font-size: 0.8rem">Anticonvulsivos</span></div>
                </div>
            </div>
        </div>

        <button id="btn-calc" class="btn-main" disabled onclick="showResults()">Calcular Esquema MILDAÂ®</button>

        <div id="res-box" class="results">
            <p style="text-transform: uppercase; font-size: 0.7rem; font-weight: 800;">RecomendaciÃ³n Semanal Sugerida</p>
            <div class="res-ui" id="ui-out">0 <small style="font-size: 1rem">UI</small></div>
            <div class="res-caps" id="caps-container">
                <span>ðŸ’Š</span> <span id="caps-out">---</span>
            </div>
            <div id="notes-out"></div>
        </div>
    </div>
</div>

<script>
    const inputs = document.querySelectorAll('input, select');
    
    inputs.forEach(input => {
        input.addEventListener('input', validateForm);
    });

    function validateForm() {
        const edadVal = document.getElementById('edad').value;
        const sexoVal = document.getElementById('sexo').value;
        const basalVal = document.getElementById('basal').value;
        const btn = document.getElementById('btn-calc');
        const adultFields = document.querySelectorAll('.adult-only');
        const embWrap = document.getElementById('wrap-emb');

        // Resetear visualizaciÃ³n de resultados si cambian datos
        document.getElementById('res-box').style.display = 'none';

        if (!edadVal) {
            btn.disabled = true;
            adultFields.forEach(el => el.classList.add('hidden'));
            return;
        }

        const edad = parseFloat(edadVal);
        const isAdult = (edad >= 19) || (edad >= 18 && sexoVal === 'F');

        if (isAdult) {
            adultFields.forEach(el => el.classList.remove('hidden'));
            
            // LÃ³gica visibilidad embarazo
            if (sexoVal === 'F' && edad <= 45) {
                embWrap.classList.remove('hidden');
            } else {
                embWrap.classList.add('hidden');
                document.getElementById('emb').checked = false;
            }

            const peso = document.getElementById('peso').value;
            const talla = document.getElementById('talla').value;
            
            // BotÃ³n habilita si tiene edad, sexo, basal, peso y talla
            btn.disabled = !(edadVal && sexoVal && basalVal && peso && talla);
        } else {
            // Perfil PediÃ¡trico
            adultFields.forEach(el => el.classList.add('hidden'));
            // BotÃ³n habilita solo con edad, sexo y basal
            btn.disabled = !(edadVal && sexoVal && basalVal);
        }
    }

    function showResults() {
        const edad = parseFloat(document.getElementById('edad').value);
        const sexo = document.getElementById('sexo').value;
        const basal = parseFloat(document.getElementById('basal').value);
        const peso = parseFloat(document.getElementById('peso').value);
        const talla = parseFloat(document.getElementById('talla').value) / 100;
        
        let diaria = 0;
        let notas = "";
        const isAdult = (edad >= 19) || (edad >= 18 && sexo === 'F');

        if (!isAdult) {
            if (basal < 30) {
                if (edad <= 0.5) diaria = 1000;
                else if (edad <= 0.9) diaria = 1500;
                else if (edad <= 3) diaria = 2500;
                else if (edad <= 8) diaria = 3000;
                else diaria = 4000;
            } else { diaria = 400; }
        } else {
            let pool = [];
            const imc = peso / (talla * talla);
            const isEmb = document.getElementById('emb').checked;
            const isPre = document.getElementById('pre').checked;
            const isOst = document.getElementById('ost').checked;
            const isCon = document.getElementById('con').checked;

            // Dosis base adultos
            if (edad >= 19 && edad <= 69) pool.push(600);
            else if (edad >= 70 && edad <= 74) pool.push(800);
            else if (edad >= 75) pool.push(sexo === 'M' ? 800 : 900);

            if (isEmb) {
                pool = [isCon ? 3000 : 2000];
                notas += "<div class='note'>Si la ganancia de peso es â‰¥ 20%, reforzar seguimiento.</div>";
            } else {
                if (imc >= 30) pool.push(125 * imc);
                if (isPre) pool.push(3600);
                if (isCon) pool.push(3000);
                if (isOst) {
                    pool.push(2000);
                    notas += "<div class='note' style='color:#004a99'>Se recomienda tomar calcio.</div>";
                }
            }
            diaria = Math.max(...pool);
        }

        const semanal = diaria * 7;
        const C1 = 5600; const C2 = 25000;
        let mejor = { txt: "0 cÃ¡psulas de MILDAÂ®", val: 0, diff: Infinity };

        if (semanal >= C1) {
            let opciones = [
                { t: `${Math.round(semanal/C1)} cÃ¡p. de 5,600 UI`, v: Math.round(semanal/C1)*C1 },
                { t: `1 cÃ¡p. de 25,000 UI`, v: C2 }
            ];
            if (semanal > C2) {
                let nMix = Math.round((semanal - C2) / C1);
                let vMix = C2 + (nMix * C1);
                opciones.push({ t: `1 cÃ¡p. de 25,000 UI + ${nMix} cÃ¡p. de 5,600 UI`, v: vMix });
            }

            opciones.forEach(o => {
                let d = Math.abs(semanal - o.v);
                if (d < mejor.diff) mejor = { txt: o.t, val: o.v, diff: d };
            });
        }

        document.getElementById('ui-out').innerHTML = `${Math.round(semanal).toLocaleString()} <small>UI</small>`;
        
        if (mejor.val === 0) {
            document.getElementById('caps-out').innerText = "0 cÃ¡psulas de MILDAÂ®";
            notas = "<div class='msg-adecuado'>El nivel de vitamina D es adecuado y no requiere suplementaciÃ³n.</div>" + notas;
        } else {
            document.getElementById('caps-out').innerText = mejor.txt;
        }

        document.getElementById('notes-out').innerHTML = notas;
        document.getElementById('res-box').style.display = 'block';
    }
</script>
</body>
</html>
